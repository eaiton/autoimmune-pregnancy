# Characterising the effects of genetic liability to autoimmune conditions on pregnancy outcomes using Mendelian Randomization

## Project overview
The aim of this project was to determine potential causal effects of liability to autoimmune conditions on pregnancy outcomes using Mendelian randomization (MR). This repository includes the analysis plan and code to run all analyses related to the manuscript.

## Outline
The scripts were run in the following order:
* 1_download_gwas.R to retrieve exposure SNP instruments for liability to each autoimmune condition
* 2_a_sel_proxies.R finds proxy SNPs, for in case instruments are not available in the outcome GWAS data
* 2_b_snp_list.R writes a list of exposure and proxy SNPs
* 2_c_iv_strength.R estimates the strength of genetic instruments
* 3_sel_out.R retrieves the SNP-outcome associations from pregnancy outcome GWASes generated by the MR-PREG collaboration
* 4_mr.R runs all Mendelian randomization analyses, saving results from:
> - main analysis using the inverse-variance-weighted (IVW) estimator with meta-analysed outcome GWAS
> - pleiotropy-robust estimators: MR-Egger, weighted median
> - MR-Egger intercept test
> - Cochran's Q-statistic
> - leave-one-SNP-out
> - excluding SNPs in the HLA region
> - leave-one-study-out from outcome GWAS
> - adjusting for fetal genetics
* 5_phenome_scan.R runs a phenome-wide association scan (PheWAS) on influential SNPs identified through the leave-one-SNP-out analysis
* 6_forest_plot.R makes forest plots showing main results for primary and secondary outcomes

## Directories
These scripts assume the following directory structure:
```
/working
├── data
│   ├── gwas
│   ├── exposure_dat
│   ├── outcome
│   └── proxies
│
├── results
│   ├── PheWAS
│   └── forest_plots
│
├── scripts
│   ├── autoimmune
│   │   ├── 1_download_gwas.R
│   │   ├── 2_a_sel_proxies.R
│   │   ├── 2_b_snp_list.R
│   │   ├── 2_c_iv_strength.R
│   │   ├── 3_sel_out.R
│   │   ├── 4_mr.R
│   │   ├── 5_phenome_scan.R
│   │   └── 6_forest_plot.R
│   ├── functions
│   │   └── generate_outdat_with_proxies.R
│   └── README.md
```

## Environmental variables
The code uses some environment variables, which need to be set in your linux environment. 
Directories can be temporarily set with:

```bash
export AUTOIMMUNE_DIR=".../" # directory with /working inside

export MRPREG_sumdat=".../" # directory with outcome GWAS summary statistics

export LDLINK_TOKEN=".../" # LDlink tokens required to retrieve proxies,
# details on how to set this here:
# https://ldlink.nih.gov/?tab=apiaccess

export OPENGWAS_TOKEN=".../" # OpenGWAS API token required to retrieve
# catalogue of SNP associations to run phenome-wide association scan,
# details on how to set this here:
# https://mrcieu.github.io/ieugwasr/articles/guide.html#authentication
```
